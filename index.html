<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Train Schedular</title>


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- <script type="text/javascript" src=".\assets\javascript\javascript.js"></script>-->
    <!-- Firebase References -->
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>

    <!-- Link to Moment.js should go here -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

</head>

<body class="text-center">
    <div class="container">
        <div class="jumbotron">
            <h1>Any Time is Train time</h1>
            <p>Choo Choo Chee Chee.</p>
        </div>
    </div>

    <div class="container">
        <h2>Train Schedule</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Train Name</th>
                    <th>Destination</th>
                    <th>Frequency</th>
                    <th>Next Arrival</th>
                    <th>Minutes Away</th>
                </tr>
            </thead>
            <tbody id="member-list">
                <tr>
                    <td>Choo Choo</td>
                    <td>Denver</td>
                    <td>2</td>
                    <td>5:00pm</td>
                    <td>2</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="container">
        <form role="form">
            <div class="form-group row">
                <label for="name-input">Train Name:</label>
                <input class="form-control" id="tName-input" type="text">
            </div>
            <div class="form-group row">
                <label for="email-input">Destination:</label>
                <input class="form-control" id="destination-input" type="text">
            </div>
            <div class="form-group row">
                <label for="email-input">First Train Time (HH:mm - Milatary Time</label>
                <input class="form-control" id="firstTime-input" type="text">
            </div>
            <div class="form-group row">
                <label for="email-input">Frequency:</label>
                <input class="form-control" id="frequency-input" type="text">
            </div>
    </div>
    <button class="btn btn-default" id="add-train" type="submit">Submit</button>
    </form>
    </div>

    <script>
        // ========================================== START CODING BELOW!!

        // Initialize Firebase


        const config = {
            apiKey: "AIzaSyCnPj0WOEgDUHXLbpXG9ML6OHXXp2vX_4U",
            authDomain: "bob1-31197.firebaseapp.com",
            databaseURL: "https://bob1-31197.firebaseio.com",
            projectId: "bob1-31197",
            storageBucket: "",
            messagingSenderId: "580808993373",
            appId: "1:580808993373:web:7b72705b758e6415"
        };

        firebase.initializeApp(config);

        var dataRef = firebase.database();

        var trainData = dataRef.ref('trainData');


        // Initial Values
        var firstTime = "03:30";

        // Assumptions
        var tFrequency = 0;

        // train name
        var tName = "";

        // train Desinsation 
        var tDestination = "";

        // First Time (pushed back 1 year to make sure it comes before current time)
        var firstTimeConverted = moment(firstTime, "HH:mm").subtract(1, "years");
        console.log(firstTimeConverted);

        // Current Time
        var currentTime = moment();
        console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));

        // Difference between the times
        var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
        console.log("DIFFERENCE IN TIME: " + diffTime);

        // Time apart (remainder)
        var tRemainder = diffTime % tFrequency;
        console.log(tRemainder);

        // Minute Until Train
        var tMinutesTillTrain = tFrequency - tRemainder;
        console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);

        // Next Train
        var nextTrain = moment().add(tMinutesTillTrain, "minutes");
        console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));

        // Capture Button Click
        $("#add-train").on("click", function (event) {
            event.preventDefault();

            // YOUR TASK!!!
            // Code in the logic for storing and retrieving the most recent user.
            // Don't forget to provide initial data to your Firebase database.
            tname = $("#tName-input").val().trim();
            tDestination = $("#destination-input").val().trim();
            firstTime = $("#firstTime-input").val().trim();
            tFrequency = $("#frequency-input").val().trim();

            // Code for the train data
            trainData.push({
                tname: tname,
                tDestination: tDestination,
                firstTime: firstTime,
                tFrequency: tFrequency
            });



        });

    trainData.on("child_added", function (childSnapshot) {
    
    // Log everything that's coming out of snapshot
    console.log(childSnapshot.val());
    // Firebase watcher + initial loader HINT: This code behaves similarly to .on("value")
    console.log(childSnapshot.val().tname);
    console.log(childSnapshot.val().tDestination);
    console.log(childSnapshot.val().firstTime);
    console.log(childSnapshot.val().tFrequency);

    var tr = $("<tr>");
    tr.append("<td>" + childSnapshot.val().tname + "</td>");
    tr.append("<td>" + childSnapshot.val().tDestination + "</td>");
    tr.append("<td>" + childSnapshot.val().firstTime + "</td>");
    tr.append("<td>" + childSnapshot.val().tFrequency + "</td>");
    $("#member-list").append(tr);

     // Handle the errors
}, function (errorObject) {
    console.log("Errors handled: " + errorObject.code);
});


    </script>


</body>

</html>